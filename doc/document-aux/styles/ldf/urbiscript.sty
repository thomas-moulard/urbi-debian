% See "make keywords" in kernel/src to keep up to date.
\lstdefinelanguage[]{urbiscript}
{
  morekeywords={
    BIN, __HERE__, and, and_eq, asm, assert, at, auto, bitand, bitor,
    bool, break, call, case, catch, char, class, closure, compl,
    const, const_cast, continue, default, do, double, dynamic_cast,
    else, emit, enum, every, explicit, export, extern, external,
    finally, float, for, foreach, freezeif, friend, function, goto,
    if, in, inline, int, internal, long, loop, loopn, mutable,
    namespace, not, not_eq, onleave, or, or_eq, private, protected,
    public, register, reinterpret_cast, return, self, short, signed,
    sizeof, static, static_cast, stopif, struct, switch, template,
    this, throw, timeout, try, typedef, typeid, typename, union,
    unsigned, using, var, virtual, volatile, waituntil, wchar_t,
    whenever, while, xor, xor_eq
  },
  morekeywords={
    at\&, at\,, at\;, at\|, every\&, every\,, every\;, every\|, for\&,
    for\,, for\;, for\|, loop\&, loop\,, loop\;, loop\|, while\&, while\,,
    while\;, while\|
  },
  alsodigit={\&, \,, \|, \;},
  morecomment=[l]{//},
  morecomment=[n]{/*}{*/},
  morestring=[b]",
  sensitive=true,
  literate={~}{{$\sim$}}1%
}

\definecolor{urbiAnswers}{rgb}{0.5,0.5,0.5}

\ifx\ifHtml\undefined
  \newcommand\urbiAnswerPre{}
  \newcommand\urbiAnswerPost{}
\fi
\newcommand{\urbiAnswer}[1]{%
  \urbiAnswerPre%
  \color{urbiAnswers}%
  #1%
  \urbiAnswerPost%
}

\lstdefinelanguage[interactive]{urbiscript}[]{urbiscript}
{
  % moredelim=[il][\urbiAnswerStyle]{..},
  % Meta variable.
  moredelim=[is][\ttfamily\itshape]{\\var\{}{\}},
  moredelim=[il][\urbiAnswer]{[:]},
  % This is a constraint to respect: anything that includes `[00'
  % is considered to denote an interactive Urbi session, regardless of
  % the rest of the line.  I can imagine lists of integers starting
  % with '[0', but '[00' is less likely.  Just beware (and maybe a
  % "make check" would be safer").
  moredelim=[l][\urbiAnswer]{[00},
  % morecomment=[il] is buggy, instead of removing everything until
  % the end of line, it goes until the end of the environment.  Use
  % we use a special opening/closing comment pair.
  morecomment=[is]{/*(*/}{/*)*/},
}
