%% Copyright (C) 2010, Gostai S.A.S.
%%
%% This software is provided "as is" without warranty of any kind,
%% either expressed or implied, including but not limited to the
%% implied warranties of fitness for a particular purpose.
%%
%% See the LICENSE file for more information.

\chapter{Release Notes}
\label{sec:news}

This chapter lists the user-visible changes in \usdk releases.

\section{\usdk 2.3}
Released on 2010-09-28.

\subsection{Fixes}
\begin{itemize}
\item \refSlot[Date]{asFloat} is restored.
\item \refSlot[File]{create} empties existing files first.
\item \refSlot[Lobby]{lobby} always returns the current lobby, even if
  invoked on another lobby.
\item \refSlot[Object]{inspect} works properly, even if the target is a
  remote lobby.
\item \slot[Regexp]{match}s renamed as \refSlot[Regexp]{matches}.
\item \refSlot[System]{version} Really returns the current version.
\item Fix multiple race conditions in RTP handling code preventing proper
  initialization of remote UObjects.
\item Fix Windows deployment to have both debug and release UObjects
  installed.
\item Fix \command{urbi-sound} in the liburbi examples.
\item Fix server mode of \samp{urbi-launch --remote}.
\end{itemize}

\subsection{New Features}
\begin{itemize}
\item The documentation of \urbi SDK Remote, our middleware layer to
  communicate with an \urbi server --- either by hand or via the UObjects
  ---, is included in the binary packages (in
  \file{share/doc/urbi-sdk/sdk-remote.htmldir/index.html}.  It is also
  available on-line at
  \url{\downloadUrl/\packageTarname/\packageVersion/doc/sdk-remote.htmldir}.

\item In addition to Gostai Console 2.5, Windows installers of \usdk now
  include the Gostai Editor 2.4.1.

\item By popular demand, all the Boost libraries (1.38) are included in the
  binary packages.  We used to provide only the headers and libraries \usdk
  depends upon.  Boost.Python, because it has too many dependencies, is not
  included.

\item When launched with no input (i.e., none of the options
  \option{-e}/\option{--expression}, \option{-f}/\option{--file},
  \option{-P}/\option{--port} were given), the interpreter is interactive.

\item Assignment operators such as \lstinline|'+='| are redefinable.  See
  \autoref{sec:lang:iass}.

\item \refSlot[Date]{'-'} accepts a \refObject{Duration} or a
  \refObject{Float} in addition to accepting a \refObject{Date}.

\item \refSlot[Float]{fresh} generates unique integers.

\item \refSlot[InputStream]{close}.

\item \refSlot[List]{'+='}.

\item Support for \lstinline|else| in \lstinline|try| blocks
  (\autoref{sec:lang:catch}).  Run only when the \lstinline|try|
  block completed properly.
\begin{urbiscript}
// Can we run "riskyFeature"?
try { riskyFeature } catch { false } else { true };
[00004220] false

function riskyFeature() { throw "die" }|;
try { riskyFeature } catch { false } else { true };
[00004433] false

riskyFeature = function () { 42 }|;
try { riskyFeature } catch { false } else { true };
[00004447] true
\end{urbiscript}

\item Support for \lstinline|finally| in \lstinline|try| blocks
  (\autoref{sec:lang:except:finally}).  Use it for code that must be run
  whatever the control flow can be.  For instance:
\begin{urbiscript}
try { echo(1) } catch { echo(2) } else { echo(3) } finally { echo(4) };
[00002670] *** 1
[00002670] *** 3
[00002670] *** 4

try { throw 1 } catch { echo(2) } else { echo(3) } finally { echo(4) };
[00002671] *** 2
[00002671] *** 4
\end{urbiscript}

\item \refSlot[System]{eval} and \refSlot[System]{load} report syntax
  warnings.
\begin{urbiscript}
eval("new Object");
[00001388:warning] !!! 1.1-10: `new Obj(x)' is deprecated, use `Obj.new(x)'
[00001388:warning] !!!    called from: eval
[00001388] Object_0x1001b2320
\end{urbiscript}
\item New functions \lstinline|as| and \lstinline|fill| on UVar to ease access
to the generic cast system.
\item Add support to \code{boost::unordered\_map} to UObject casting system.
\item Optimize remote UObjects: notifies between two objects in the same
  process instance are transmitted locally.
\item Provide a \code{CustomUVar} class to ease encapsulation of custom data
  in UVar.
\item Bind the \code{constant} property on UVar.
\end{itemize}


\section{\usdk 2.2}
Released on 2010-08-23.

\subsection{Fixes}
\begin{itemize}
\item The main loop optimization triggered several issues with GNU/Linux and
  Mac OS X in interactive sessions (truncated output, possibly blocked
  input).  These issues are fixed on Snow Leopard and Leopard and GNU/Linux.
\item Deep overall of the event handling primitives.  Watching an expression
  will succeed in cases where it used to fail.  For instance:

\begin{urbiscript}
at (isdef (myVar))
  echo("var myVar = " + myVar),

myVar;
[00000001:error] !!! lookup failed: myVar

var myVar = 42|;
[00000003] *** var myVar = 42
\end{urbiscript}

\noindent
or

\begin{urbiunchecked}
var x = 0|;
function f() { x == 1 }|;
at (f()) echo("OK");
x = 1|;
[00000001] *** OK
\end{urbiunchecked}

  Support for sustained events is fixed too (see \autoref{sec:lang:at}).
\item \refSlot[List]{max} and \refSlot[List]{min} will now report the right
  indexes in error messages.
\item \lstinline|onleave| blocks on lasting events are now run
  asynchronously, as expected.
\item \lstinline|at (expression ~ duration)| is now supported.
\item Fix a bug if emitting an event triggers its unsubscription.
\item Fix printing of \lstinline|Exception.Type| and
  \lstinline|Exception.ArgumentType|.
\item Fix timestamp overflow on Windows after 40 minutes.
\item Fix fatal error when manipulating the first \var{Job} prototype.
\end{itemize}


\subsection{New Features}
\begin{itemize}
\item Pressing \key{C-c} in the \us shell (\samp{urbi -i}) interrupts the
  foreground job, and clears the pending commands.  A second \key{C-c} in a
  row invokes \refSlot[System]{shutdown}, giving a chance to the system to
  shut down properly.  A third \key{C-c} kills
  \command{urbi}/\command{urbi-launch}.  See
  \autoref{sec:tools:urbi:quitting} for more details.
\item Closing the standard input (e.g., by pressing \key{C-d}) in
  interactive sessions shuts down the server.
\item Remote UObjects now support the RTP protocol to exchange value with
  the engine (\autoref{sec:uob:api:rtp}).
\item NotifyChange/access callbacks can now take any type as argument.
  \lstinline|UVar&| still has the previous behavior. For any other type,
  the system will try to convert the value within the UVar to this type.
\item \refSlot[CallMessage]{eval}.
\item \refSlot[Float]{ceil}, \refSlot[Float]{floor}, \refSlot[Float]{isInf},
  \refSlot[Float]{isNan}.
\item \refObject{Traceable}.
\item Improved context (the call stacks) when error are reported.
  Especially when using \refSlot[System]{eval}/\refSlot[System]{load}.
\item \lstinline|at (expression)| --- as opposed to \lstinline|at (event?)| ---
  implementation has been improved: the condition will now be reevaluated even
  if a parameter not directly in the expression (in the body of a called
  function, for instance) is modified.
\item \slot[Regexp]{match}s.
\item \refObject{Date} objects now have microsecond resolution and
  have bit slightly revamped to not rely on Unix's epoch.
\item UVars now have the timestamp of their latest assignment.
\end{itemize}

\subsection{Documentation}
\begin{itemize}
\item \refSlot[Float]{hex}.
\end{itemize}

\section{\usdk 2.1}
Released on 2010-07-08.

\subsection{Fixes}
\begin{itemize}
\item \refSlot[Lobby]{connectionTag} monitors the jobs launched from the
  lobby, but can no longer kill the lobby itself.
\item \samp{123foo} is no longer accepted as a synonym to \samp{123 foo}.
  As a consequence, in case you were using \lstinline|x = 123cos: 1|,
  convert it to \lstinline|x = 123 cos: 1|.
\item Some old tools that no longer make sense in \usdk 2.0 have been
  removed: \command{umake-engine}, \command{umake-fullengine},
  \command{umake-lib}, \command{umake-remote}.  Instead, use
  \command{umake}, see \autoref{sec:tools:umake}.
\item On Windows \command{urbi-launch} could possibly miss module files to
  load if the extension (\samp{.dll}) was not specified.  One may now
  safely, run \samp{urbi-launch my-module} (instead of \samp{urbi-launch
    my-module.dll} or \samp{urbi-launch my-module.so}) on all the platforms.
\end{itemize}

\subsection{New Features}
\begin{itemize}
\item \refSlot[Regexp]{asPrintable}, \refSlot[Regexp]{asString},
  \refSlot[Regexp]{has}.
\item \refSlot[System.Platform]{host}, \refSlot[System.Platform]{hostAlias},
  \refSlot[System.Platform]{hostCpu}, \refSlot[System.Platform]{hostOs},
  \refSlot[System.Platform]{hostVendor}.
\item UObject init method and methods bound by notifyChange no longer need
  to return an int.
\item \refSlot[Channel]{Filter}, a \refObject{Channel} that outputs text
  that can be parsed without error by the liburbi.
\item \refSlot[RangeIterable]{all}, \refSlot[RangeIterable]{any}, moved from
  \refObject{List}.
\item Support for \href{http://www.ros.org}{ROS}, the Robot Operating
  System.  See \autoref{sec:tut:ros} for an introduction, and
  \autoref{sec:specs:ros} for the details.
\item \refSlot[Lobby]{lobby} and \refSlot[Lobby]{instances}, bounced to from
  \refSlot[System]{lobby} and \refSlot[System]{lobbies}.
\item \refSlot[Tag]{scope}, bounced to from \refSlot[System]{scopeTag}.
\end{itemize}

\subsection{Optimization}
\begin{itemize}
\item The main loop was reorganized to factor all socket polling in a single
  place: latency of \refObject{Socket} is greatly reduced.
\end{itemize}

\subsection{Documentation}
\begin{itemize}
\item \refSlot[Lobby]{authors},  \refSlot[Lobby]{thanks}.
\item \refObject{System.PackageInfo}.
\item \refSlot[System]{spawn}.
\item LEGO Mindstorms NXT support (\autoref{sec:nxt}).
\item Pioneer 3-DX support (\autoref{sec:p3dx}).
\item Support for Segway RMP (\autoref{sec:segway-rmp}).
\end{itemize}


\section{\usdk 2.0.3}
Released on 2010-05-28.

\subsection{New Features}
\begin{itemize}
\item \refObject{Container}, prototype for \refObject{Dictionary},
  \refObject{List} derive.
\item \lstinline|\var{e} not in \var{c}| is mapped onto
  \lstinline|\var{c}.hasNot(\var{e})| instead of
  \lstinline|!\var{c}.has(\var{e})|.
\item \refObject{Float.limits}
\item \refSlot[Job]{asString}
\item \refObject{IoService}
\item \refSlot[Event]{'<<'}
\item \refSlot[List]{argMax}, \refSlot[List]{argMin}, \refSlot[List]{zip}
\item \refSlot[Tuple]{'+'}
\item \refSlot[Tuple]{'*'}
\item Assertion failures are more legible:

\begin{urbiscript}
var one = 1|;
var two = 2|;
assert (one == two);
[00000002:error] !!! failed assertion: one == two (1 != 2)
\end{urbiscript}

  \noindent
  instead of

\begin{urbiunchecked}
assert (one == two);
[00000002:error] !!! failed assertion: one.'=='(two)
\end{urbiunchecked}
  \noindent
  previously.  As a consequence, \lstinline{System.assert_op} is deprecated.
  The never documented following slots have been removed from
  \refObject{System}: \lstinline{assert_eq}, \lstinline{assert_ge},
  \lstinline{assert_gt}, \lstinline{assert_le}, \lstinline{assert_lt},
  \lstinline{assert_meq}, \lstinline{assert_mne}, \lstinline{assert_ne}.
\end{itemize}

\subsection{Fixes}
\begin{itemize}
\item \refSlot[List]{'<'} and \refSlot[Tuple]{'<'} implement true
  lexicographic order: \lstinline|[0, 4] < [1, 3]| is true.  List comparison
  used to implement member-wise comparison; the previous assertion was not
  verified because \lstinline|4 < 3| is not true.
\item \refSlot[Mutex]{asMutex} is fixed.
\item \refObject{Directory} events were not launched if a
  \refObject{Directory} had already been created on the same
  \refObject{Path}.
\item \lstinline"waituntil" no longer ignores pattern guards.
\end{itemize}

\subsection{Documentation}
\begin{itemize}
\item Bioloid (\autoref{sec:bioloid}).
\item Garbage collection (\autoref{sec:lang:gc}).
\item Structural Pattern matching (\autoref{sec:lang:pattern}).
\item \refSlot[CallMessage]{sender} and \refSlot[CallMessage]{target}.
\item \refSlot[Dictionary]{asString}.
\item \refSlot[Directory]{fileCreated} and \refSlot[Directory]{fileDeleted}.
\item \refSlot[List]{max}, \refSlot[List]{min}.
\item \refSlot[Mutex]{asMutex}.
\item \refSlot[Object]{localSlotNames}.
\end{itemize}

\section{\usdk 2.0.2}
Released on 2010-05-06.

\subsection{\us}
\begin{itemize}
\item \refSlot[Control]{detach} and \refSlot[Control]{disown} return the
  \refObject{Job}.
\end{itemize}

\subsection{Fixes}
\begin{itemize}
\item \samp{make install} failures are addressed.
\item \lstinline|freezeif| can be used more than once inside a scope.
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item \refObject{StackFrame}
\item \refSlot[String]{split}
\end{itemize}

\section{\usdk 2.0.1}
Released on 2010-05-03.

\subsection{\us}
\begin{itemize}
\item Minor bug fixes.
\item The short option \option{-v} is reserved for \option{--verbose}.
  Tools that mistakenly used \option{-V} for \option{--verbose} and
  \option{-v} for \option{--version} have been corrected (short options are
  swapped).  Use long options in scripts, not short options.
\item \refSlot[Lobby]{echoEach}: new.
\item \refSlot[String]{closest}: new.
\item \refSlot[Tuple]{size}: new.
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item How to build \usdk (\autoref{sec:build}).
\item Hyperlinks to slots (e.g., \refSlot[Float]{asString}).
\end{itemize}

\subsection{Fixes}
\begin{itemize}
\item Closures enclose the lobby.  Now slots of the lobby in which the
  closure has been defined are visible in functions called from the closure.
\end{itemize}

\section{\usdk 2.0}

Released on 2010-04-09.

\subsection{\us}

\subsubsection{Changes}

\begin{itemize}
\item \slot{Global}{Tags} is renamed as \refSlot[Tag]{tags}.

\item \slot{Global}{Task} is renamed as \refSlot[Global]{Job}.

\item \slot{Global}{topLevel} is renamed as \refSlot[Channel]{topLevel}.

\item \slot{Global}{output}, \slot{Global}{error} are removed, they were
  deprecated in favor of \refSlot[Global]{cout} and \refSlot[Global]{cerr}.

\item \refSlot[Object]{getPeriod} is deprecated in favor of
  \refSlot[System]{period}.

\item As announced long ago, and as displayed by warnings,
  \refSlot[Object]{slotNames} now returns all the slot names, ancestors
  included.  Use \refSlot[Object]{localSlotNames} to get the list of the
  names of the slot the object owns.

\item \refSlot[Semaphore]{acquire} and \refSlot[Semaphore]{release} are
  promoted over \refSlot[Semaphore]{p} and \refSlot[Semaphore]{v}.
\end{itemize}

\subsubsection{New features}

\begin{itemize}
\item Dictionary can now be created with literals.

  \begin{center}
    \begin{tabular}{|c|c|}
      \hline
      Syntax & Semantics\\
      \hline
      \lstinline|[ => ]|
      &
      \lstinline|Dictionary.new|
      \\
      \lstinline|["a" => 1, "b" => 2, "c" => 3]|
      &
      \lstinline|Dictionary.new("a", 1, "b", 2, "c", 3)|
      \\
      \hline
    \end{tabular}
  \end{center}

\item \refSlot[Float]{srandom}
\item \refSlot[List]{subset}
\item \refSlot[Object]{getLocalSlot}.
\item String escapes accept one- and two-digit octal numbers.
  For instance \lstinline|"\0"|, \lstinline|"\00"| and
  \lstinline|"\000"| all denote the same value.

\item Tuple can now be created with literals.

  \begin{center}
    \begin{tabular}{|c|c|}
      \hline
      Syntax & Semantics\\
      \hline
      \lstinline|()|        & \lstinline|Tuple.new([])| \\
      \lstinline|(1,)|      & \lstinline|Tuple.new([1])| \\
      \lstinline|(1, 2, 3)| & \lstinline|Tuple.new([1, 2, 3])| \\
      \hline
    \end{tabular}
  \end{center}

\item Location.'=='.

\item type replaces \lstinline|'$type'| %% Pacify emacs: $
\end{itemize}

\subsection{UObjects}

\begin{itemize}
\item Remote timers (USetUpdate, USetTimer) are now handled locally
  instead of by the kernel.
\item UVars can be copied using the \refSlot[UVar]{copy} method.
\item New UEvent class, similar to UVar. Can be used to emit events.
\item Added support for dictionaries: new UDictionary structure in the
  UValue union.
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item \refObject{Barrier}
\item \refSlot[Date]{now}
\item \refSlot[Float]{srandom}
\item \refObject{Pattern}
\item \refObject{PubSub}
\item \refObject{PubSub.Subscriber}
\item \refObject{Profiling}
\item \refObject{Semaphore}
\item Trajectories
\item \refObject{TrajectoryGenerator}
\item urbi-image
\item waituntil clauses
\item whenever clauses
\end{itemize}

\section{\usdk 2.0 RC 4}
Released on 2010-01-29.

\subsection{\us}
\subsubsection{Changes}

\begin{itemize}
\item \lstinline|'$id'| replaces id
\item List derives from Orderable.
\end{itemize}

\subsubsection{New objects}
\begin{itemize}
\item \refObject{Location}
\item \refObject{Position}
\end{itemize}

\subsubsection{New features}
\begin{itemize}
\item \refSlot[File]{remove}
\item \refSlot[File]{rename}
\end{itemize}

\subsection{UObjects}

\begin{itemize}
\item The UObject API is now thread-safe: All UVar and UObject
  operations can be performed from any thread.
\item You can request bound functions to be executed asynchronously in
  a different thread by using UBindThreadedFunction instead of
  UBindFunction.
\end{itemize}


\section{\usdk 2.0 RC 3}
Released on 2010-01-13.

\subsection{\us}

\subsubsection{Fixes}
\begin{itemize}
\item \file{local.u} works as expected.
\end{itemize}

\subsubsection{Changes}
\begin{itemize}
\item \refSlot[Lobby]{quit} replaces \slot[System]{quit}.
\item \refSlot[Socket]{connect} accepts integers.
\item UObject remote notifyChange on USensor variable now works as expected.
\item UObject timers can now be removed with UObject::removeTimer().
\end{itemize}

\subsection{Documentation}

\begin{itemize}
\item \refObject{Socket} provides a complete example.
\item The Naming Standard documents the support classes provided to ease
  creation of the component hierarchy.
\end{itemize}

\section{\usdk 2.0 RC 2}
Released on 2009-11-30.

This release candidate includes many fixes and improvements that are
not reported below. The following list is by no means exhaustive.

\subsection{Optimization}

The \us engine was considerably optimized in both space and
time.

\subsection{urbiscript}

\subsubsection{New constructs}

\begin{itemize}
\item \lstinline|assert { claim1; claim2;... };|

\item \lstinline{every|}

\item \lstinline|break| and \lstinline|continue| are supported in
  \lstinline{every|} loops.

\item \lstinline|for(num)| and \lstinline|for(var i: set)| support the
  \lstinline|for&|, \lstinline{for|} and \lstinline|for;| flavors.

\item \lstinline|for(init; cond; inc)| supports the \lstinline{for|}
  and \lstinline|for;| flavors.

\item non-empty lists of expressions in list literals, in function calls,
  and non-empty lists of function formal arguments may end with a
  trailing optional comma.  For instance:

\begin{urbiunchecked}
function binList(a, b,) { [a, b,] } | binList(1, 2,)
\end{urbiunchecked}

  \noindent
  is equivalent to

\begin{urbiunchecked}
function binList(a, b) { [a, b] } | binList(1, 2)
\end{urbiunchecked}

\item consecutive string literals are joined into a unique string
  literal, as in \Cxx.
\end{itemize}

\subsubsection{New objects}
\begin{itemize}
\item \refObject{Component}, \refObject{Localizer}, \refObject{Interface}:
  naming standard infrastructure classes.
\item \refObject{Date}
\item \refObject{Directory}
\item \refObject{File}
\item \refObject{Finalizable}: objects that call \lstinline|finalize()| when
  destroyed.
\item \refObject{InputStream}
\item \refObject{Mutex}
\item \refObject{OutputStream}
\item \refObject{Process}: Start and monitor child processes.
\item \refObject{Regexp}
\item \refObject{Server}: TCP/UDP server socket.
\item \refObject{Socket}: TCP/UDP client socket.
\item \refObject{Timeout}
%%% FIXME: use \refObject when documented.
\item \code{WeakDictionary}, \code{WeakPointer}: Store
  dictionary of objects without increasing their reference count.
\end{itemize}

\subsubsection{New features}
\begin{itemize}
\item \refSlot[Object]{asBool}.
\item \refSlot[Lobby]{wall}.
\item \refSlot[Dictionary]{size}.
\item \refSlot[Global]{evaluate}.
\item \refSlot[Group]{each}, \lstinline|Group.each&|
\item \refSlot[Lobby]{onDisconnect}, \refSlot[Lobby]{remoteIP}
  \refSlot[Lobby]{create}.
\item \refSlot[Object]{inspect}.
\item \refSlot[String]{fromAscii}, \refSlot[String]{replace},
  \refSlot[String]{toAscii}.
\item System: \lstinline|_exit|, \lstinline|assert_eq|,
  \refSlot[System]{system}.
\end{itemize}

\subsubsection{Fixes}
\begin{itemize}
\item at constructs do not leak local variables anymore.
\item Each tag now has its enter and leave events.
\item \refSlot[File]{content} reads the whole file.
\item Invalid assignments such as \lstinline|f(x) = n| are now refused as
  expected.
\end{itemize}

\subsubsection{Deprecations}
\begin{itemize}
\item \slot{Object.ownsSlot} is deprecated in favor of
  \refSlot[Object]{hasSlot}/\refSlot[Object]{hasLocalSlot}.
\item \refSlot[Object]{slotNames} is deprecated in favor of
  \refSlot[Object]{allSlotNames}/\refSlot[Object]{localSlotNames}.
\end{itemize}

\subsubsection{Changes}
\begin{itemize}
\item empty strings, dictionaries and lists are now evaluated as
  "false" in conditions.
\item \refSlot[Dictionary]{asString} does not sort the keys.
\item \refSlot[Dictionary]{'[]='} returns the assigned value, not the
  dictionary.
\item \refSlot[Dictionary]{'[]'} raises an exception if the key is missing.
\item Constants is merged into Math.
\item \lstinline|every| no longer goes in background.  Instead of:

\begin{urbiunchecked}
every (1s) echo("foo");
\end{urbiunchecked}

  \noindent
  write (note the change in the separator)

\begin{urbiunchecked}
every (1s) echo("foo"),
\end{urbiunchecked}

  \noindent
  or

\begin{urbiunchecked}
detach({ every (1s) echo("foo"); });
\end{urbiunchecked}

\item Tag: begin and end now simply print the tag name followed by
  \samp{begin} or \samp{end}.
\item System-code is now hidden from the backtraces.
\item \refSlot[Code]{apply}: the call message can be changed by passing it
  as an extra argument.
\end{itemize}

\subsection{UObjects}
\begin{itemize}
\item Handle UObject destruction. To remove an UObject, call the \us
  \code{destroy} method. The corresponding \Cxx instance will be deleted.

\item Add \lstinline|UVar::unnotify()|. When called, it removes all
  UNotifyChange registered with the UVar.

\item Bound functions using UBindFunction can now take arguments of type
  \lstinline|UVar&| and \lstinline|UObject*|. The recommended method to pass
  UVars from urbiscript is now to use \samp{camera.getSlot("val")} instead
  of \samp{"camera.val"}.

\item Add a 0-copy mode for UVars: If \samp{UVar::enableBypass(true)} is
  called on an UVar, notifyChange on this UVar can recover the not-copied
  data by using \lstinline|UVar.get()|, returning an
  \lstinline|UValue&|. However, the data is only accessible from within
  notifyChange: reading the UVar directly will return nil.

\item Add support for the \lstinline|changed!| event on UVars. Code like:

\begin{urbiunchecked}
at (headTouch.val->changed? if headTouch.val)
  tts.say("ouch");
\end{urbiunchecked}
  \noindent
  will now work. This hook costs one \lstinline|at| per UVar, and can be
  disabled by setting \refSlot[UVar]{hookChanged} to false.

\item Add a statistics-gathering tool. Enable it by calling
  \samp{uobjects.enableStats(true)}. Reset counters by calling
  \samp{uobjects.clearStats}. \samp{uobjects.getStats} will return a
  dictionary of all bound \Cxx function called, including timer callbacks,
  along with the average, min, max call durations, and the number of calls.

\item When code registered by a notifyChange throws, the exception is
  intercepted to protect other unrelated callbacks. The throwing
  callback gets removed from the callback list, unless the
  removeThrowingCallbacks on the UVar is false.

\item the environment variable \env{URBI\_UOBJECT\_PATH} is used by
  urbi-launch and urbiscript's loadModule to find uobjects.

\item fixed multiple notifications of event trigger in remote UObjects.

\item Many other bug fixes and performance improvements.

\item an exception is now thrown if the C++ init method failed.
\end{itemize}


\subsection{Documentation}

The documentation was fixed, completed, and extended.  Its layout was
also improved.  Changes include, but are not limited to:

\begin{itemize}
\item various programs: \command{urbi}, \command{urbi-launch},
  \command{urbi-send} etc. (\autoref{sec:tools}).
\item environment variables: \env{URBI\_UOBJECT\_PATH}, \env{URBI\_PATH},
  \env{URBI\_ROOT} (\autoref{sec:tools:envvars}).
\item special files \file{global.u}, \file{local.u}
  (\autoref{sec:tools:files}).
\item k1-to-k2: Conversion idioms from \us 1 to \us 2 (\autoref{sec:k1}).
\item FAQ (\autoref{sec:faq})
  \begin{itemize}
  \item stack exhaustion
  \item at and waituntil: performance considerations
  \end{itemize}
\item Specifications:
  \begin{itemize}
  \item completion of the definition of the control flow constructs
    (\lstinline|every|, \lstinline{every|}, \lstinline|if|,
    \lstinline|for|, \lstinline|loop|)
  \item tools (umake, umake-shared, umake-deepclean, urbi,
    urbi-launch, urbi-send).
  \item \refObject{Boolean}
  \item \refObject{Channel}
  \item \refObject{Date}
  \item \refObject{Dictionary}
  \item \refObject{Exception}
  \item \refObject{File}
  \item \refObject{Kernel1}
  \item \refObject{InputStream}
  \item \refObject{Lazy}
  \item \refObject{Math}
  \item \refObject{Mutex}
  \item \refObject{Regexp}
  \item \refObject{Object}
  \item \refObject{OutputStream}
  \item \refObject{Pair}
  \item \refObject{String}
  \item \refObject{Tag}
  \item \refObject{Timeout}
  \end{itemize}
\item tutorial:
  \begin{itemize}
  \item uobjects
  \end{itemize}
\end{itemize}

\subsection{Various}

\begin{itemize}
\item Text files are converted to DOS end-of-lines for Windows packages.

\item \command{urbi-send} supports \option{--quit}.

\item The files \file{global.u}/\file{local.u} replace
  \file{URBI.INI}/\file{CLIENT.INI}.

\item \command{urbi} supports \option{--quiet} to inhibit the banner.
\end{itemize}

\section{\usdk 2.0 RC 1}
Released on 2009-04-03.

\subsection{Auxiliary programs}

\begin{itemize}
\item \command{urbi-send} no longer displays the server version
  banner, unless given \option{-b}/\option{--banner}.
\item \command{urbi-console} is now called simply \command{urbi}.
\item \command{urbi.bat} should now work out of the box under windows.
\end{itemize}


\subsection{\us}

\subsubsection{Syntax of events}

The keyword \lstinline|emit| is deprecated in favor of \lstinline|!|.

\begin{center}
  \begin{tabular}{|c|c|}
    \hline
    Deprecated & Updated \\
    \hline
    \lstinline|emit e;| &              \lstinline|e!;| \\
    \lstinline|emit e(a);| &           \lstinline|e!(a);| \\
    \lstinline|emit e ~ 1s;| &         \lstinline|e! ~ 1s;| \\
    \lstinline|emit e(a) ~ 1s;| &      \lstinline|e!(a) ~ 1s;| \\
    \hline
  \end{tabular}
\end{center}

The \lstinline|?| construct is changed for symmetry.

\begin{center}
  \begin{tabular}{|c|c|}
    \hline
    Deprecated & Updated \\
    \hline
   \lstinline|at (?e)|                  & \lstinline|at (e?)|\\
   \lstinline|at (?e(var a))|           & \lstinline|at (e?(var a))|\\
   \lstinline|at (?e(var a) if 0 <= a)| & \lstinline|at (e?(var a) if 0 <= a)|\\
   \lstinline|at (?e(2))|               & \lstinline|at (e?(2))|\\
 \end{tabular}
\end{center}

This syntax for sending and receiving is traditional and can be found
in various programming languages.

\subsubsection{Changes}

\begin{itemize}
\item \refObject{System.Platform} enhances former \slot[System]{platform}.
  Use \refSlot[System.Platform]{kind} instead of \slot[System]{platform}.
\end{itemize}

\subsubsection{Fixes}
\begin{itemize}
\item Under some circumstances successful runs could report "at job
  handler exited with exception TerminateException".  This is fixed.

\item Using waituntil on an event with no payload (i.e.,
  \lstinline|waituntil(e?) ...;)| will not cause an internal error
  anymore.
\end{itemize}

\subsection{URBI Remote SDK}

The API for plugged-in UObjects is not thread safe, and never was:
calls to the API must be done only in the very same thread that runs
the Urbi code.  Assertions (run-time failures) are now triggered for
invalid calls.

\subsection{Documentation}

Extended documentation on: \refObject{Comparable}, \refObject{Orderable}.


\section{\usdk 2.0 beta 4}
Released on 2009-03-03.

\subsection{Documentation}

An initial sketch of documentation (a tutorial, and the language and
library specifications) is included.

\subsection{\us}
\subsubsection{Bug fixes}

\begin{itemize}
\item Bitwise operations.

  The native "long unsigned int" type is now used for all the bitwise
  operations (\lstinline|&|, \lstinline{|}, \lstinline|^|,
  \lstinline|compl|, \lstinline|<<|, \lstinline|>>|).  As a consequence it
  is now an error to pass negative operands to these operations.

\item \refSlot[System]{PackageInfo}.

  This new object provides version information about the Urbi package.  It
  is also used to ensure that the initialization process uses matching Urbi
  and \Cxx files.  This should prevent accidental mismatches due to
  incomplete installation processes.

\item Precedence of operator \lstinline|**|.

  In conformance with the usage in mathematics, the operator \lstinline|**|
  now has a stronger precedence than the unary operators.  Therefore, as in
  Perl, Python and others, '-2 ** 2 == -4' whereas it used to be equal to
  '4' before (as with GNU bc).

\item \lstinline|whenever| now properly executes the else branch when the
  condition is false.  It used to wait for the condition to be verified at
  least once before.
\end{itemize}

\subsubsection{Changes}

\begin{itemize}
\item \refSlot[String]{asFloat}

  This new method has been introduced to transform a string to a float.  It
  raises a PrimitiveError exception if the conversion fails:

\begin{urbiscript}
"2.1".asFloat;
[00000002] 2.1
"2.0a".asFloat;
[00000003:error] !!! asFloat: unable to convert to float: "2.0a"
\end{urbiscript}
\end{itemize}

\subsection{Programs}

\subsubsection{Environment variables}

The environment variable \env{URBI\_ROOT} denotes the directory which
is the root of the tree into which Urbi was installed.  It corresponds
to the "prefix" in GNU Autoconf parlance, and defaults to
\file{/usr/local} under Unix.  urbiscript library files are expected
to be in <URBI\_ROOT>/share/gostai/urbi.

The environment variable URBI\_PATH, which allows to specify a
colon-separated list of directories into which urbiscript files are
looked-up, may extend or override URBI\_ROOT.  Any superfluous colon
denotes the place where the URBI\_ROOT path is taken into account.

\subsubsection{Scripting}

To enable writing (batch) scripts seamlessly in Urbi, \command{urbi-console}
\option{-f}/\option{--fast} is now renamed as \option{-F}/\option{--fast}.
Please, never use short options in batch programs, as they are likely to
change.

Two new option pairs, \option{-e}/\option{--expression} and
\option{-f}/\option{--file}, plus the ability to reach the command line
arguments from Urbi make it possible to write simple batch Urbi programs.
For instance:

\begin{shell}
$ cat demo
#! /usr/bin/env urbi-console
cout << System.arguments;
shutdown;

$ ./demo 1 2 3 | grep output
[00000004:output] ["1", "2", "3"]
\end{shell}

\subsubsection{urbi-console}

urbi-console is now a simple wrapper around urbi-launch.  Running

\begin{shell}
urbi-console arg1 arg2...
\end{shell}

\noindent
is equivalent to running

\begin{shell}
urbi-launch --start -- arg1 arg2...
\end{shell}


\subsubsection{Auxiliary programs}
The command line interface of \command{urbi-sendbin} has been updated.
\command{urbi-send} now supports \option{-e}/\option{--expression} and
\option{-f}/\option{--file}.  For instance

\begin{urbiunchecked}
$ urbi-send -e 'var x;' -e "x = $value;" -e 'shutdown;'
\end{urbiunchecked}



\section{\usdk 2.0 beta 3}
Released on 2009-01-05.

\subsection{Documentation}

A new document, \file{FAQ.txt}, addresses the questions most frequently
asked by our users during the beta-test period.

\subsection{\us}

\subsubsection{Fixes}

\begin{itemize}
\item If a file loaded from \file{URBI.INI} cannot be found, it is now
  properly reported.
\end{itemize}


\subsubsection{Changes}

\begin{description}
\item \lstinline|new| syntax revamped

  The syntax "new myObject(myArgs)" has been deprecated and now gives a
  warning. The recommended "myObject.new(myArgs)" is suggested.

\item \lstinline|delete| has been removed

  \lstinline|delete| was never the right thing to do. A local variable
  should not be deleted, and a slot can be removed using
  \refSlot[Object]{removeSlot}.  The construct "delete object" has been
  removed from the language.

\item \lstinline|__HERE__|

  The new \lstinline|__HERE__| pseudo-symbol gives the current position.  It
  features three self explanatory slots: "file", "line", and "column".

\item Operator "()"

  It is now possible to define the "()" operator on objects and have it
  called as soon as at least one parameter is given:

\begin{urbiscript}
class A {
  function '()' (x) { echo("A called with " + x) };
}|;
A;
[00000001] A
A();
[00000002] A
A(42);
[00000003] *** A called with 42
\end{urbiscript}

\item \lstinline|catch(\var{type} \var{name}| syntax removed

  It was used to catch exceptions if and only if they inherited
  \var{type}. This behavior can be obtained with the more general guard
  system:

\begin{urbiunchecked}
catch (var e if e.isA(<type>))
{
  ...
}
\end{urbiunchecked}

\item Pattern matching and guards in catch blocks

  Exception can now be filtered thanks to pattern matching, just like
  events. Moreover, the pattern can be followed by the "if" keyword and an
  arbitrary guard. The block will catch the exception only if the guard is
  true.

\begin{urbiunchecked}
try
{ ... }
catch ("foo") // Catch only the "foo" string
{ ... }
catch (var x if x.isA(Float) && x > 10) // Catch all floats greater than 10
{ ... }
catch (var e)  // Catch any other exception
{ ... }
\end{urbiunchecked}

\item Parsing of integer literals

  The parser could not read integer literals greater than 2**31-1.  This
  constraint has been alleviated, and Urbi now accepts integer literals up
  to 2**63-1.

\item Display of integer literals

  Some large floating point values could not be displayed correctly at the
  top level of the interpreter. This limitation has been removed.

\item Variables binding in event matching

  Parentheses around variables bindings ("var x") are no longer required in
  event matching:

\begin{urbiunchecked}
at (?myEvent(var x, var y, 1))
\end{urbiunchecked}

\noindent
instead of:

\begin{urbiunchecked}
at (?myEvent((var x), (var y), 1))
\end{urbiunchecked}

\item Waituntil and bindings

  Bindings performed in "waituntil" constructs are now available in its
  context:

\begin{urbiunchecked}
waituntil(?event(var x));
// x is available
echo (x);
\end{urbiunchecked}

\item "\refSlot[List]{insert}" method

  Now uses an index as its first argument and inserts the given element
  before the index position:

\begin{urbiscript}
["a", "b", "c"].insert(1, "foo");
[00000001] ["a", "foo", "b", "c"]
\end{urbiscript}

\item "\refSlot[List]{sort}" method

  Now takes an optional argument, which is a function to call instead of the
  "<" operator. Here are two examples illustrating how to sort strings,
  depending on whether we want to be case-sensitive (the default) or not:

\begin{urbiscript}
["foo", "bar", "Baz"].sort;
[00000001] ["Baz", "bar", "foo"]
["foo", "bar", "Baz"].sort(function(x, y) {x.toLower < y.toLower});
[00000002] ["bar", "Baz", "foo"]
\end{urbiscript}

\item "\refSlot[System]{searchPath}" method

  It is now possible to get the search path for files such as \file{urbi.u}
  or \file{URBI.INI} by using \refSlot[System]{searchPath}.

\item "\refSlot[System]{getenv}" method

  Now returns "nil" if a variable cannot be found in the environment instead
  of "void". This allows you do to things such as:

\begin{urbiscript}
var ne = System.getenv("nonexistent");
if (!ne.isNil) do_something(ne);
\end{urbiscript}

  \noindent
  while previously you had to retrieve the environment variable twice, once
  to check for its existence and once to get its content.

\item "\refSlot[Control]{disown}"

  It is now possible to start executing code in background while dropping
  all the tags beforehand, including the connection tag. The code will still
  continue to execute after the connection that created it has died.

\item "\refSlot[Object]{removeSlot}"

  Now silently accepts non-existing slot names instead of signaling an
  error.

\item "\refSlot[Semaphore]{criticalSection}"

  It is now possible to define a critical section associated with a
  semaphore. The \refSlot[Semaphore]{acquire} method will be called at the
  beginning, and if after that the operation is interrupted by any means the
  \refSlot[Semaphore]{release} operation will be called before going on. If
  there are no interruption, the \refSlot[Semaphore]{release} operation will
  also be called at the end of the callback:

\begin{urbiunchecked}
var s = \refSlot[Semaphore]{new}(1);
s.criticalSection(function () { echo ("In the critical section") });
\end{urbiunchecked}

\item "\refSlot[System]{stats}"
  Its output is now expressed in seconds rather than milliseconds, for
  consistency with the rest of the kernel.
\end{description}

\subsection{UObjects}

\begin{description}
\item[void] The error message given to the user trying to cast a void UVar
  has been specialized.

  Remote bound methods can now return void.


\item[Coroutine interface]

  The functions \lstinline|yield()|, \lstinline|yield_until()|, and
  \lstinline|yield_until_things_changed()| have been added to the
  UObject API. They allow the user to write plugin UObject code that
  behaves like any other coroutine in the kernel: if yield() is called
  regularly, the kernel can continue to work while the user code runs.
  Meaningful implementation for these functions is provided also in
  remote mode: calling yield() will allow the UObject remote library
  to process pending messages from within the user callback.

\item[Remote UObject initialization]

  Remote UObject instantiation is now atomic: the API now ensures that
  all variables and functions bound from the UObject constructor and
  init are visible as soon as the UObject itself is visible. Code
  like:

\begin{urbiunchecked}
waituntil(uobjects.hasSlot("MyRemote")) | var m = \refSlot[MyRemote]{new}();
\end{urbiunchecked}

\noindent
is now safe.
\end{description}

\subsection{Auxiliary programs}

\begin{description}
\item[urbi-launch] Now, options for \command{urbi-launch} are separated from
  options to give to the underlying program (in remote and start modes) by
  using \option{--}. Use \samp{urbi-launch --help} to get the full usage
  information.
\end{description}



\section{\usdk 2.0 beta 2}
Released on 2008-11-03.

\subsection{\us}

\begin{description}
\item "object" and "from" as identifiers

  "object" and "from" are now regular identifiers and can be used as other
  names.  For example, it is now legal to declare:

\begin{urbiscript}
var object = 1|;
var from = 1|;
\end{urbiscript}

\item Hexadecimal literals
  It is now possible to enter (integral) hexadecimal numbers by
  prefixing them with "0x", as in:

\begin{urbiscript}
0x2a;
[00000001] 42
\end{urbiscript}

Only integral numbers are supported.

%% FIXME: The hexadecimal representation of a number can be obtained by specifying the
%% FIXME: base to \refSlot[Float]{asString}:
%% FIXME:
%% FIXME: \begin{urbiscript}
%% FIXME: 42.asString(16);
%% FIXME: [00000001] "2a"
%% FIXME: // \refSlot[Float]{hex} is a shortcut:
%% FIXME: 42.hex;
%% FIXME: [00000001] "2a"
%% FIXME: \end{urbiscript}
\end{description}

\subsection{Standard library}
\begin{description}

\item \refSlot[String]{asList}

  "String" now has a "asList" method, which can be used transparently to
  iterate over the characters of a string:

\begin{urbiscript}
for (var c: "foo") echo (c);
[00000001] *** f
[00000002] *** o
[00000003] *** o
\end{urbiscript}

\item \refSlot[String]{split} method Largely improved.

%%% FIXME: \item "\refSlot[String]{join}" method
%%% FIXME:
%%% FIXME:   It is now possible to easily join list members by inserting an
%%% FIXME:   arbitrary string between them:
%%% FIXME:
%%% FIXME: \begin{urbiscript}
%%% FIXME: ", ".join(["abc", "def", "ghi"]);
%%% FIXME: [00000001] "abc, def, ghi"
%%% FIXME: \end{urbiscript}
\item "min" and "max"

It is now possible to call "min" and "max" on a list. By default, the
"<" comparison operator is used, but one explicit `lower than'
function can be provided as "min" or "max" argument should one be
needed. Here is an example on how to compare strings in case-sensitive
and case-insensitive modes:

\begin{urbiscript}
["the", "brown", "Fox"].min;
[00000001] "Fox"
["the", "brown", "Fox"].min(function (l, r) { l.toLower < r.toLower });
[00000002] "brown"
\end{urbiscript}

Global functions "min" and "max" taking an arbitrary number of
arguments have also been defined. In this case, the default "<"
operator is used for comparison:

\begin{urbiscript}
min(3, 2, 17);
[00000001] 2
\end{urbiscript}

\item Negative indices

It is now possible to use negative indices when taking list elements.
For example, -1 designates the last element, and -2 the one before that.

\begin{urbiscript}
["a", "b", "c"][-1];
[00000001] "c"
\end{urbiscript}

\item Tag names

  Tags were displayed as \lstinline|Tag_0xADDR| which did not make
  their "name" slot apparent. They are now displayed as "Tag<name>":

\begin{urbiscript}
Tag.new;
[00000001] Tag<tag_1>
Tag.new("mytag");
[00000002] Tag<mytag>
\end{urbiscript}

\item "every" and exceptions

If an exception is thrown and not caught during the execution of an "every"
block, the "every" expression is stopped and the exception displayed.
\end{description}

\subsection{UObjects}
\begin{description}
\item "UVar::type()" method

It is now possible to get the type of a "UVar" by calling its "type()"
method, which returns a "UDataType" (see \file{urbi/uvalue.hh} for the
types declarations).
\end{description}

\subsection{Run-time}
\begin{description}
\item Stack exhaustion check on Windows

  As was done on GNU/Linux already, stack exhaustion condition is detected
  on Windows, for example in the case of an infinite recursion. In this
  case, SchedulingError will be raised and can be caught.

\item Errors from the trajectory generator are propagated

  If the trajectory generator throws an exception, for example because it
  cannot assign the result of its computation to a non-existent variable,
  the error is propagated and the generator is stopped:

\begin{urbiunchecked}
xx = 20 ampli:5 sin:10s;
[00002140:error] !!! lookup failed: xx
\end{urbiunchecked}
\end{description}

\subsection{Bug fixes}
\begin{description}
\item Support for Windows shares

  Previous versions of the kernel could not be launched from a Windows
  remote directory whose name is starting with two slashes such as
  \file{//share/some/dir}.

\item Implement "UVar::syncValue()" in plugged uobjects

  Calling "syncValue()" on a "UVar" from a plugged UObject resulted in a
  link error.  This method is now implemented, but does nothing as there is
  nothing to do. However, its presence is required to be able to use the
  same UObject in both remote and engine modes.

\item "isdef" works again

  The support for k1 compatibility function "isdef" was broken in the case
  of composed names or variables whose content was "void". Note that we do
  not recommend using "isdef" at all. Slots related methods such as
  "getSlot", "hasSlot", "locateSlot", or "slotNames" have much cleaner
  semantics.

\item "\_\_name" macro

  In some cases, the \lstinline|__name| macro could not be used with
  plugged uobjects, for example in the following expression:

\begin{urbiunchecked}
send(__name + ".val = 1;");
\end{urbiunchecked}
  \noindent
  This has been fixed. \lstinline|__name| contains a valid slot name
  of \lstinline|uobjects|.
\end{description}

\subsection{Auxiliary programs}

The sample programs demonstrating the SDK Remote, i.e., how to write a
client for the Urbi server, have been renamed from \command{urbi*} to
\command{urbi-*}.  For instance \command{urbisend} is now spelled
\command{urbi-send}.

Besides, their interfaces are being overhauled to be more consistent with
the Urbi command-line tool-box.  For instance while \command{urbisend} used
to require exactly two arguments (host-name, file to send), it now supports
options (e.g., \option{--help}, \option{--port} to specify the port etc.),
and as many files as provided on the command line.


%% == New in 2.0 beta 1 ==
%% Released on 2008-10-21.
%% === Full Object Orientation Support ===
%%  * Everything is an object.[[br]]
%%    In the 1.x series there were several kind of entities: numbers,
%%    lists, strings, images, etc. and objects.  In the 2.x series,
%%    everything is an object, including the atomic values.  For instance
%%    {{{"foo"}}} evaluates into an object that derives from the
%%    {{{String}}}.
%%
%%  * Objects are dictionaries of slots.[[br]]
%%    Objects are implemented as associative arrays: a mapping from
%%    symbols to objects.
%%
%%  * The distinction between value and function is blurred.[[br]]
%%    From a software engineering point of view, the client (i.e., the
%%    "caller") should not know how the provider (i.e., the "callee") is
%%    implemented.  In particular, it is an implementation detail whether
%%    {{{object.feature}}} is an attribute, or a function taking no
%%    argument.  Therefore, parentheses are not needed to invoke
%%    functions that do not have argument (other that {{{self}}}.
%%
%%    {{{
%%    # 0-ary functions and attributes should behave equally.
%%    var feature = 42;
%%    [11648000] 42
%%    feature;
%%    [11680000] 42
%%    feature();
%%    [11712000] 42
%%    feature(42);
%%    [11776000:error] !!! input.u:8.1-11: expected 0 arguments, given 1
%%
%%    feature = function () { 42 };
%%    [11872000] function () {
%%      42
%%    }
%%    feature;
%%    [12000000] 42
%%    feature();
%%    [12128000] 42
%%    feature(42);
%%    [12192000:error] !!! input.u:10.1-11: expected 0 arguments, given 1
%%
%%    feature = function (x) { x };
%%    [12256000] function (x) {
%%      x
%%    }
%%    feature;
%%    [12288000:error] !!! input.u:26.1-7: expected 1 arguments, given 0
%%    feature();
%%    [12288000:error] !!! input.u:28.1-9: expected 1 arguments, given 0
%%    feature(42);
%%    [12384000] 42
%%    }}}
%%
%%  * Functions are first-class citizens.[[br]]
%%    In other words, functions are objects and can be manipulated like
%%    any other type of object.  For instance you may copy a function
%%    from an object to another.  Be careful though that by default code
%%    is evaluated, see the following example.
%%
%%    {{{
%%    var counter_ = 0;
%%    [09856000] 0
%%    var counter = function () { counter_ += 1; };
%%    [09952000] function () {
%%      counter_.'+='(1);
%%    }
%%    counter;
%%    [10080000] 1
%%    counter;
%%    [10208000] 2
%%    var counter2 = counter;
%%    [10368000] 3
%%    counter2;
%%    [10400000] 3
%%    counter2;
%%    [10432000] 3
%%    var counter3 = getSlot("counter");
%%    [10528000] function () {
%%      counter_.'+='(1);
%%    }
%%    counter3;
%%    [10656000] 4
%%    counter3;
%%    [10784000] 5
%%    counter;
%%    [10912000] 6
%%    }}}
%%
%%  * Arbitrary identifiers.[[br]]
%%    Identifiers can be composed of any sequence of characters enclosed
%%    between {{{'}}}, but some sequences behave magically.
%%    * Regular identifiers.[[br]]
%%      Traditional identifiers ({{{MyObject}}}, {{{my_function_2}}},
%%      {{{SomeVariableName}}} etc.) need no quotes.
%%    * Traditional connectives.[[br]]
%%      Connectives such as {{{+}}}, {{{*}}}, {{{<=}}} and so forth, when
%%      used unquoted behave as usual (e.g., {{{1 < 2}}}), but between
%%      quotes, they behave like regular function names (e.g.,
%%      {{{1.'<'(2)}}}).
%%
%%  * Fewer primitives, more expressive power.[[br]]
%%    The basic connectives, such as {{{+}}}, {{{*}}}, {{{<=}}} and so
%%    forth, are regular functions that the user can freely define.
%%    For instance {{{Person.'<' = function (rhs) { name < rhs.name }}}}
%%    define the {{{<}}} between {{{Person}}}.
%%
%%  * Objects can be arbitrarily nested.[[br]]
%%    The previous limitations of the language are alleviated, and the
%%    {{{.}}} connective can now be freely used.  For instance:
%%
%%    {{{robot.leg("rear-left").joint("knee").value}}}
%%
%%  * Name spaces.[[br]]
%%
%%    There is no global name space in the Urbi language: there are no
%%    global variables or functions in the traditional sense.  Rather,
%%    the Urbi world is a network of objects that use each other (either
%%    via inheritance, or via aggregation).  To reach a particular
%%    object, for instance {{{Object}}} from which all the objects
%%    derive, one uses a series of local names starting from the current
%%    object.
%%
%%    For instance {{{true}}} is defined as a member of
%%    {{{Object.Constants}}}, which is a prototype of {{{Object}}} (i.e.,
%%    {{{Object}}} "derives" from {{{Object.Constants}}}.  Since every
%%    object derives from {{{Object}}}, the {{{true}}} is available from
%%    anywhere.
%%
%%  * Lobbies.[[br]]
%%
%%    Sessions with the Urbi server, via files or via network
%%    connections, are handled via "lobbies".  Lobbies implement the
%%    local scope: variables introduced during the interaction are
%%    only visible from this lobby.  Nevertheless, because lobbies are
%%    connected to the rest of the Urbi network of objects, the user can
%%    introduce new features in the common space, for instance by
%%    extending {{{Object}}}.  The user may also provide access to
%%    his/her own lobby by giving it a name in an object that is
%%    reachable from the other lobbies.
%%
%%  * An object can have any number of prototypes.[[br]]
%%    Multiple inheritance is fully supported.  This allows to factor
%%    common code.  For instance the object {{{Orderable}}} provides
%%    implementations of ordered comparators in terms of each other
%%    (e.g., {{{function '>=' (rhs) { rhs < self }}}}), and
%%    {{{Comparable}}} relates {{{==}}} and {{{!=}}}.  If your
%%    {{{object}}} provides {{{==}}} and {{{<}}}, then running
%%    {{{object.addProto(Comparable);object.addProto(Orderable);}}}
%%    provides the others.
%%
%%
%% === Tickless kernel ===
%% The kernel doesn't consume more CPU than needed and avoids to do any busy
%% loop. This should greatly dicrease the robots battery consumtion.
%%
%% === Closures ===
%% It is now possible to create local functions that are able to access local
%% variables of their enclosing scope. For instance, the following code will
%% create a function {{{makeCounter}}} which returns a new function acting
%% as an independent counter, incrementing its result each time it is called.
%%
%% {{{
%% var Object.makeCounter = function () {
%%   var count = 0;
%%   makeClosure (function () { count++ })
%% };
%%
%% var counter1 = Object.makeCounter;
%% counter1;
%% [14760721] 0
%% counter1;
%% 17192816] 1
%%
%% var counter2 = Object.makeCounter;
%% counter2;
%% [37131341] 2
%%
%% counter1;
%% [45807168] 3
%%
%% }}}
%%
%% === Deprecated features are removed. ===
%%
%% The following constructs, deprecated in the 1.x series, are no
%% longer supported.
%%
%%  * Function call syntax[[br]]
%%    Function calls are normalized to {{{object.method(args)}}}.
%%    * {{{<object> inherits <object>}}}.
%%    * {{{<object> disinherits <object>}}}.
%%    * {{{<object> on}}}.
%%    * {{{<object> off}}}.
%%    * {{{<object> switch}}}.
%%    * {{{copy <arg>}}}
%%    * {{{echo <arg>}}}
%%    * {{{sleep <arg>}}}
%%  * {{{<integer> ^ <integer> denotes binary xor}}}.
%%  * {{{foreach}}} and {{{loopn}}}.
%%  * {{{wait(<duration>)}}}, use {{{sleep}}}.
%%  * new variables must be declared with {{{var}}}.
%%
%% == New in 1.6 ==
%%
%% === inherits and disinherits are deprecated ===
%% Inheritance now uses the regular function calling scheme.
%% Rather than {{{sub inherits super}}}, write {{{sub.inherit(super)}}}.
%%
%% Note {{{inherit}}} vs. {{{inherits}}}.  Likewise for {{{disinherit}}}
%% and {{{disinherits}}}.
%%
%% === Connections can be prioritized. ===
%%
%% Use {{{setpriority N}}} to set a connection priority. Valid range is
%% [-100, 100]. Default value is 0.  A second connection is created on
%% startup with priority 80, loading the file {{{URBIRT.INI}}}.
%%
%% === Kernel can be 'sealed' ===
%% To prevent interference with high-priority code, use {{{seal}}}.
%% Once activated:
%%   * no {{{+connection}}} can be used to connections with higher priority.
%%   * no {{{setpriority}}} can be called with a positive value.
%%
%%
%% == New in 1.5 ==
%%
%% === "foreach" and "loopn" are deprecated ===
%% Use "for" instead.
%%
%% === Use "**", not "^", to denote exponentiation ===
%% In the future "^" between numbers will denote exclusive-or.
%%
%% === Consistent function call syntax ===
%%
%% {{{copy}}}, {{{echo}}}, and {{{wait}}} use a more traditional function
%% syntax === Use {{{echo (1)}}} instead of {{{echo 1}}}, and {{{wait
%% (1s)}}} instead of {{{wait 1s}}}.  Similarly with {{{copy}}}.
%%
%% === Job control and channels are different. ===
%% The structure {{{tag : code}}} used to address two different issues:
%% enabling job control, and reporting values.  They now have two
%% different syntaxes.  Write {{{chan << code}}} to send the evaluation
%% of {{{code}}} to the channel {{{chan}}}, and write {{{tag : code}}} to allow
%% job control over {{{code}}}.
%%
%% === Numbers ===
%% Numbers are no longer output in fixed format, hence 1+2*3 yields
%% 7, no longer 7.000000.  Besides, so called "scientific notation"
%% is supported: {{{1e-5}}} stands for {{{0.00001}}} etc.
%%
%% == New in 1.0 ==
%%
%% === New keyword `taglist' ===
%% To display the tags of currently running commands.
%%
%% === UObject::send(string) ===
%% It is now available to send URBI code from any UObject
%% (plugged or remote). The code is executed immediately in plugin mode, which
%% makes it convenient to add specialized initialization in UObject
%% constructors to setup some useful wrappers.
%%
%% == New in 1.0 RC2: ==
%%
%% === USensor becomes UOwned ===
%% (with backward compatibility).
%%
%% === Function redefinition ===
%% It is now OK to redefine a function that already exist, you will get a
%% warning in scrict mode only.
%%
%% === inherit changes to 'inherits' ===
%% Same for disinherit.
%%
%% === UNotifyChange bug fix. ===
%%
%% Important bug fix on UNotifyChange: was not working with motor variables
%% like headPan.val from within a UObject. NotifyAccess and NotifyChange
%% simultaneous usage has also been improved in plugin mode.
%%
%%
%% New in 1.0 RC1:
%%
%% === New support for multi events ===
%% Example:
%% {{{
%%   at (e(x)) echo x;
%%   emit e(4) & emit e(11);
%%   [00018969:notag] *** 11.000000
%%   [00018969:notag] *** 4.000000
%% }}}
%% === 'events' keyword ===
%% To list existing declared events.
%%
%% === Do not use 'return' inside functions defining background commands ===
%%   like 'at', return will terminate function and everything it contains.
%%   Simply end the function without calling return, and use a comma when you
%%   call it:
%% {{{
%%   function f()
%%   {
%%     at (test) ping;
%%   };
%%   f(),
%% }}}
%%
%% === Multiple inheritance ===
%% The inherit/disinherit keywords are now available to manage inheritance and
%% multiple inheritance at runtime. Syntax:
%% {{{
%%   class1 inherit class2;
%%   class1 disinherit class2;
%% }}}
%%
%% === {{{::}}} ===
%%
%% The :: construct allows you to call a parent method inside a redefined
%% {{{
%%   subclass method:
%%
%%   function parent.f(x) { ... };
%%   sub = new parent;
%%   function sub.f(x)
%%   {
%%     parent::f(x);
%%     ...
%%   };
%% }}}
%%
%%   This is a powerful feature needed in more advanced object-oriented
%%   programming.
%%
%%
%% == Version 1.0 beta2                        released on xx.xx.2006 ==
%%
%% === Bug fixes ===
%%  * derivative extension fixed for autoupdate variables
%%
%% === New features ===
%%  * add delete operator
%%  * group objects, hardware, software added
%%
%% === Changes ===
%%  * renamed global. into system.
%%
%%
%% == Version 1.0.0                        released on xx.xx.2006 ==
%%
%% === Bug fixes ===
%%  * lists of lists works now
%%
%% === New features ===
%%  * lists can contain any type of data, including binary
%%
%% === Changes ===
%%
%%  * register with {{{external var <name>}}} or
%%    {{{external function(<nbparam>) <name>}}} or
%%    {{{external event(<nbparam>) <name>}}}.
%%  * syntax change def=>var, function or event, defcheckon=>strict, group=>alias
%%  * class implementation (see detail in doc)
%%  * emit() now works (<=> emit(inf))
%%
%% === To do ===
%%
%%  * add event def (out of class definition)
%%  * class
%%    * add function def
%%    * add event def
%%    * operator new
%%    * call to init
%%    * inheritance integrated class a:b {...};
%%    * function polymorphism
%%    * var polymorphism
%%    * name resolution inside function => class members identification
%%  * aliases update
%%  * list type?
%%  * a=b <=> alias a b? yes, with alias unicity
%%
%% == Version 0.9.8                        released on xx.01.2006 ==
%%
%% === Bug fixes ===
%%  * sgn now works as expected
%%  * addition of lists now works correctly
%%  * || or && separated events now work fine
%%  * closed connection do no hold zombie events anymore
%%  * context is now properly liberated when a parse error occur inside a
%%  function definition
%%
%% === New features ===
%%  * 'list groupname.var' evaluates as the list [groupmember1.var,
%%  groupmember2.val]...
%%
%% == Version 0.9.7                        released on 29.10.2005 ==
%%
%% Major changes in the kernel interface to allow softdevices to be plugged in
%% the kernel
%%
%% === Bug fixes ===
%%  * memoryleak on {{{+timeout}}} flag is fixed
%%  * multiple flags are now handled properly
%%  * softtest in functions are now handled properly
%%  * {{{'n}}} now works with virtual devices
%%  * operator priority in tests is now fixed
%%  * at memory leak from 0.9.7  now fixed
%%  * {{{$(...)}}} inside function now works properly
%%
%% === New features ===
%%  * the command {{{connections;}}} returns a list of opened connections
%%  * new flag: {{{+connection("U1234566") : command}}} starts the command in
%%  the given connection. Can also be used with {{{all}}} as a parameter
%%  (starts in every connection) or {{{other}}} (starts in every connection
%%  except the current one). You can create a chat room with this:
%%  myname+connection("other"):echo "hello!";
%%  * .val is now optional with devices and virtual devices. headPan.val is
%%  equivalent to headPan. Makes the code simpler.
%%  * event integrated, emit is available (see doc for full description)
%%  * added 'loadwav' function
%%  * time values can now be expressed as a combination of d,h,m,s,ms
%%  * new {{{every (time) ...}}} command
%%  * the {{{reset}}} command now virtually reboot your robot, so that you can
%%  reload scripts and test modifications easily
%%  * the {{{undefall}}} command clear all user defined variables and functions
%%  * list type is now available: {{{[1,2,"bla",14]}}}. You can iterate a list
%%  L with the {{{foreach}}} command: {{{foreach i in L {...}}}};
%%  * {{{+bg}}} flag added
%%  * echo can now have a connection modifier to specify a connection where the
%%  message is displayed: echo "..." connection:ID. ID can be {{{all}}} or
%%  {{{other}}} or a specific connection ID.
%%  * partial test evaluation occurs now when (false && b) or (true || b) is
%%  calculated (b is not evaluated)
%%  * prefixing variables with {{{local}}} make then explicitely local to the
%%  connection, which is useful inside functions to access local variables.
%%  * sgn(x) function
%%
%% === Changes ===
%%
%%  * ball.x and ball.y are now centered between -1/2 and 1/2, avoiding the
%%  unecessary translation
%%  * motoron and motoroff are now changed to {{{motor on}}} and {{{motor
%%        off}}}, to prepare the way for future deivce control mechanisms. You
%%  also have the {{{motor switch}}} command to change from on to off and
%%  vice-versa.
%%  * static variables are now prefixed by @. The keyword 'only' as a prefix is
%%  used where @ was before, to signal a non recursive descent in a virtual
%%  device expression.
%%  * the timeout modifier no longer exist because of conflicts with the new
%%  'timeout' command.
%%
%%
%% == Version 0.9.6c                       released on 09.09.2005 ==
%% === Bug fixes ===
%%  * {{{URBI.INI}}} was not properly read at each robot start, on a random
%%  basis. It's fixed.
%%
%%
%%
%% == Version 0.9.6b                       released on 07.09.2005 ==
%% === Bug fixes ===
%%  * the {{{>=}}} operator now works fine
%%  * operator precedence in tests has been fixed
%%  * function local variables are now correctly freed at the end of the
%%  function call
%%  * bug with undef instabilities now fixed
%%  * memory leak on tests is fixed
%%  * the stop command now works better, in particular inside nested
%%  loops. stop/freeze/block are now taking one cycle to execute (they are no
%%  more ZTEC: Zero Time Execution Commands).
%%  * fixed precedence between {{{;}}} and {{{,}}}
%%  * fixed {{{exec}}} command bug occuring in conjunction with {{{stop}}}
%%
%%
%% === New features ===
%%  * a new {{{=~=}}} comparison operator is available: it takes into accound
%%  the delta property of variables to perform a ~= comparison. Very useful to
%%  put tests on motor values. It is also better than the
%%  {{{global.epsilontilde + ~=}}} approach because it is device
%%  specific. Delta composition for complex expressions will be added soon.
%%  * the ghost connection now outputs its messages to the debug port (59000)
%%  * stopall command clears all commands in every connection. It is very powerful and should be used carefuly.
%%
%% === Changes ===
%%
%%  * tests are now expressions, like in C. You can write stuffs like {{{while
%%        (1) ...}}}
%%  * the wait command is not polymorphic anymore. Use {{{wait(t)}}} to wait a
%%  certain time and {{{waituntil(test)}}} for a condition
%%  * the {{{main}}} device is now called {{{global}}} again. The main device
%%  affects: global.name, global.device[i] and global.nbdevices,
%%  global.epsilontilde, global.epsilonpercent, global.ghostID. This name is
%%  subject to another change in the future, as it should better reflect the
%%  notion of {{{superdevice}}}.
%%  * robot.epsilontilde and robotl.epsilonpercent are now again
%%  global.epsilontilde and global.epsilonpercent for consistancy.
%%  * function {{{booleval}}} no longer exists
%%  * global.device[i] and global.joint[i] are now aliases pointing to the
%%  corresponding device.val variable, instead of strings with the device
%%  name. The old string value can now be accessed with global.devicename[i]
%%  and global.jointname[i]. This serves the most common usage of such
%%  shortcuts and save the trouble of understanding the $(...) operator for
%%  most users.
%%  * the std.u file has been modified: robot.leg aliases are now global.leg
%%  * robot.ledMode is now global.ledMode
%%  * better cpuload() measure
%%
%%
%% == Version 0.9.6                         released on 03.09.2005 ==
%%
%% === Syntax changes ===
%%   * valn is replaced by val'n. Any variable can now be accessed in a
%%   normalized form by using the 'n suffix. Other suffixes will be available
%%   in the future, extending the possibilities (average on a time frame,
%%   max/min, etc).
%%   * blend modes, ranges and speedmin/max are now set/read with
%%   variable "properties", which are accessed via the -> indirection:
%% {{{
%%    variable->blend = mix; // instead of blend[mix] variable
%%    variable->rangemin = 45;
%%    variable->rangemax;
%%    variable->speedmin = 15;
%%    variable->speedmax = 10;
%%    variable->unit = "cm";
%% }}}
%%   * the {{{delta}}} property is accessible for variables: variable->delta =
%%   ... This property set the level of tolerance when adaptive trajectory are
%%   executed. Basically, it means that the assignment {{{variable = x}}} will
%%   be done with a precision of +/- variable->delta. For normal variables, the
%%   delta is zero. For variables related to motor devices, it reflects the
%%   precision of the underlying hardware.
%%   * global.motortolerance and global.errorsensibility no longer exist and
%%   they are replaced by the corresponding joint.val delta property. Note that
%%   this property, like any property, can be assigned using a group
%%   assignment. For example: robot.val->delta = ...
%%   * the {{{delete}}} operator is replaced by {{{undef}}} which is now common
%%   for variables and functions. If both a variable and a function share the
%%   same name {{{x}}}, {{{undef x}}} will delete the function first.
%%   * the isdef function now works with variables **and** functions.
%%   * camera.ballx, camera.bally and camera.ballsize are replaced by ball.x,
%%   ball.y and ball.size. This is in prevision of future soft devices
%%   semantics.
%%   * {{{global.name}}}, {{{global.device[i]}}}, {{{global.nbdevices}}} are
%%   replaced by {{{robot.name}}}, {{{robot.device[i]}}} and
%%   {{{robot.nbdevices}}} for semantic consistancy.
%%   * the {{{+condout}}} flag is changed into {{{+stopif}}}, for consistancy
%%   with the new {{{+blockif}}} flag
%%
%% === Bug fixes ===
%%  * +report now works fine with function calls
%%  * load and exec now work as expected, they actually insert the code where
%%  the command is called (and not at the end of the execution buffer)
%%  * tags for grouped commands that include background commands now work (like
%%  tag:{at ...})
%%  * {{{loop {noop}}}} and {{{loop noop}}} now run the same, without having a
%%  double execution time difference
%%  * the FOR command morphing policy has been changed to a more semantically
%%  valid version
%%
%% === New features ===
%%  * the +blockif(test) flag is now available and the command is blocked when
%%  the test is true, unblocked when it is false.
%%  * def is now working with variables. {{{def my.var}}} defines my.var,
%%  without a type. {{{def {x;y;z}}}} defines x,y and z in one shot. {{{def
%%        mydevice {a;b}}}} defines mydevice.a and mydevice.b in one shot. The
%%  interest of this feature is to use the {{{defchekon}}} command to make the
%%  interpreter strict about undefined assignments (reject
%%  it). {{{defcheckoff}}} returns to the default permissive policy.
%%  * the 'e extension is available: it gives the difference between estimated
%%  value and measured value for a device, which is a crude measure of the
%%  force/torque for a motor device.
%%  * for any variable the ' and '' extensions are now available to return the
%%  derivative and the second derivative. The value used is the theoretical
%%  motion profile as expressed by the currently running assignments. For the
%%  real derivative and second derivative, measured from the sensor output, the
%%  'd and 'dd extensions are available.
%%
%%
%% === Changes ===
%%  * {{{def f(x) instruction;}}} is now valid if instruction is alone (no
%%  brackets needed). Otherwise, brackets must be used to enclose several
%%  commands, like: {{{def f(x) {x;x+1};}}}
%%  * array indexes are now "auto-static". There is no need to use the tab[:i]
%%  construct in a loop. tab[i] has the same effect. This is to simplify the
%%  syntax, considering that array indexes would probably never need to be
%%  non-static. ===
%%  * {{{delayed}}} motor messages no longer exist. They can be emulated
%%  trivially with: whenever (device.val'e > device.val->delta) echo {{{******
%%        delayed}}};
%%  * speedmax enforcement is now very strict and works. You can restrict any
%%  motor device {{{d}}} with: d.val->speedmax = ... (units/s)
%%
%% == Version 0.9.5                         released on 24.07.2005 ==
%%
%% Major kernel code revision for variable storage and access. Caching
%% mechanism implemented. Various perfomance optimization.
%%
%% === Bug fixes ===
%%  * fixed some bug for the propagation of {{{stop}}} commands in the command
%%  tree (now: only !UONQUEUE commands affected).
%%  * prefixes are now ignored for system functions like {{{sin}}},
%%  {{{string}}}, {{{cos}}},... This make toto.sin(2); a valid evaluation (it's
%%  very permissive) but solve a known bug with cross client function
%%  definitions.
%%  * no more spasm-like shake after a motoron when the joints have moved.
%%
%% === New features ===
%%
%%  * function 'abs' added
%%  * global.ghostID variable added: it returns the ID of the ghost connection
%%  * function cpuload() added and a warning is issued when cpuload > 120% for
%%                                 % more than 10 iterations of the work loop
%%
%% === Changes ===
%%
%%  * Aliases are now traced once when a command is executed, so dynamic
%%  modification of aliases chains will not affect already running code. This
%%  is done for optimization purposes.
%%  * variable access caching system is functional
%%  * the way the group hiearchy is passed has changed: group a {b,c};a.x=0
%%  time:10; will not generate errors on a.x anymore. Only leaves are taken
%%  into account for error report (this is a subtle problem, but you will be
%%  happy it is solved).
%%
%%
%%
%% == Version 0.9.4                         released on 05.05.2005 ==
%% === Bug fixes ===
%%  * grouped commands without tag are not labelled {{{notag}}} anymore, but
%%  __UGrouped_set_of_commands__
%%
%% === New features ===
%%  * atan function added
%%
%% === Changes ===
%%
%%  * the target value of a sin-modified assignment is constantly reevaluated
%%  during execution, not only at start.
%%  * Error messages are now prefixed by !!! and simple system messages by
%%  ******
%%  * sin assignments don't require the variable to be already defined
%%  anymore. It's just a {{{normal}}} assignment.
%%
%%
%% == Version 0.9.3                         released on 23.02.2005 ==
%%
%% === Bug fixes ===
%%
%%  * {{{valn}}} evaluation doesn't change the {{{val}}} value anymore
%%  * type mismatch with binary variables is correctly handled
%%  * tags on grouped commands (between { }) are now working
%%  * +report flag now works fine with grouped commands (between { })
%%
%% === New features ===
%%
%%  * functions are now implemented (in a limited extend, see doc)
%%  * the keyword {{{def}}} alone lists the existing function definitions
%%  * {{{undef <functionname>}}} can be used to undefine a function
%%  * {{{isdef(variable)}}} returns 1 or 0, if the variable is defined or not
%%  * arrays can now be indexed with strings and not only numbers
%%  * +timeout and +condout flags added
%%  * added the 'getphase' modificator
%%
%% === Changes ===
%%
%%  * the $() operator will now add a connectionID when no prefix is given for
%%  the variable, making it local to the connection.
%%
%% == Version 0.9.2                         released on 14.02.2005 ==
%%
%% === Bug fixes ===
%%  * fixed problem with assignment result just after a blend[mix]
%%
%% === New features ===
%%  * added a new {{{add}}} blending mode
%%
%% == Version 0.9.1                         released on 22.01.2005 ==
%%
%% === Bug fixes ===
%%  * The behavior of {{{for &}}} is now as expected in the specification.
%%
%% === New features ===
%%
%%  * added static variables usage with the {{{:}}} prefix, to freeze
%%    variable evaluation
%%
%%  * added 'alias' command
%%
%%
%%
%% == Version 0.9                           released on 12.01.2005 ==
%%
%% Initial main release, after versions 0.1, 0.2, 0.3 not included here.


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../urbi-sdk"
%%% ispell-dictionary: "american"
%%% ispell-personal-dictionary: "../urbi.dict"
%%% fill-column: 76
%%% End:
